# دليل نظام إدارة واتساب - Admin System Guide

## نظرة عامة | Overview

تم بناء نظام إدارة شامل لتطبيق واتساب يتضمن:
- إدارة المستخدمين مع الأدوار والصلاحيات
- مراقبة نشاط المستخدمين والمحادثات
- إدارة أجهزة واتساب المتصلة المتعددة
- نظام فلترة المحادثات حسب الجهاز

---

## المميزات الرئيسية | Main Features

### 1. إدارة المستخدمين | User Management
- **إضافة مستخدمين جدد** بأسمائهم والبريد الإلكتروني وكلمة المرور
- **تحديد الأدوار**: مدير (Admin) أو موظف خدمة عملاء (Agent)
- **تعيين الصلاحيات** للموظفين:
  - الرد على المحادثات
  - عرض جميع المحادثات
  - تعيين المحادثات
  - إرسال رسائل جديدة
- **تفعيل/تعطيل** حسابات المستخدمين
- **تتبع حالة الاتصال**: متصل/غير متصل
- **عرض آخر نشاط** لكل مستخدم

### 2. نشاط المستخدمين | User Activity Monitoring
- **إحصائيات شاملة**:
  - إجمالي المحادثات
  - المحادثات في الانتظار
  - المحادثات التي تم الرد عليها
  - الموظفين المتصلين حالياً
- **عرض جميع المحادثات** مع:
  - حالة الرد (في الانتظار/تم الرد)
  - الموظف المعين للمحادثة
  - رقم الجهاز المستخدم
- **فلترة المحادثات** حسب:
  - الحالة (الكل/في الانتظار/تم الرد)
  - الجهاز
  - الموظف
- **عرض الموظفين المتصلين** في الوقت الفعلي
- **المحادثات النشطة** لكل موظف

### 3. إدارة الأجهزة المتصلة | Device Management
- **إضافة أجهزة واتساب متعددة**
- **مسح QR Code** لكل جهاز
- **عرض حالة الاتصال** لكل جهاز
- **إدارة الأجهزة**: تفعيل/تعطيل/حذف

### 4. نظام الفلترة في صفحة المحادثات | Chat Filtering System
- **فلتر الأجهزة**: عرض المحادثات حسب رقم الواتساب المتصل
- **عرض رقم الجهاز** بجانب كل محادثة
- **البحث في المحادثات** مع الفلترة المتقدمة

---

## البنية التقنية | Technical Structure

### قاعدة البيانات | Database

#### جداول جديدة | New Tables:

1. **users** - تحديثات:
   - `role`: admin أو agent
   - `permissions`: JSON للصلاحيات
   - `is_active`: حالة التفعيل
   - `last_activity_at`: آخر نشاط
   - `status`: online/offline

2. **chat_assignments**:
   - `user_id`: المستخدم المعين
   - `device_id`: الجهاز
   - `chat_id`: معرف المحادثة
   - `chat_number`: رقم الهاتف
   - `status`: active/completed/transferred

3. **whatsapp_messages** - تحديثات:
   - `assigned_user_id`: الموظف المعين
   - `assigned_at`: وقت التعيين

### الـ Controllers

1. **UserManagementController**:
   - إدارة CRUD للمستخدمين
   - تفعيل/تعطيل المستخدمين

2. **ActivityController**:
   - عرض نشاط المستخدمين
   - إحصائيات المحادثات
   - تعيين المحادثات للموظفين

3. **WhatsAppWebController** - محدث:
   - دعم أجهزة متعددة
   - فلترة المحادثات حسب الجهاز

### الـ Middleware

**CheckRole**: التحقق من صلاحيات الوصول حسب الدور

---

## الاستخدام | Usage

### 1. تسجيل الدخول كمدير | Admin Login

```
البريد الإلكتروني: admin@admin.com
كلمة المرور: password
```

### 2. الوصول إلى لوحة التحكم | Dashboard Access

بعد تسجيل الدخول، ستظهر لك القائمة الجانبية مع:
- **الرئيسية**: لوحة التحكم الرئيسية
- **إدارة المستخدمين**: إضافة وتعديل المستخدمين
- **نشاط المستخدمين**: مراقبة المحادثات والنشاط
- **الأجهزة المتصلة**: إدارة أجهزة واتساب
- **المحادثات**: صفحة المحادثات مع الفلترة

### 3. إضافة مستخدم جديد | Add New User

1. اذهب إلى **إدارة المستخدمين**
2. اضغط على **إضافة مستخدم جديد**
3. املأ البيانات:
   - الاسم
   - البريد الإلكتروني
   - كلمة المرور
   - الدور (مدير/موظف)
   - الصلاحيات (للموظفين فقط)
4. اضغط **حفظ المستخدم**

### 4. إضافة جهاز واتساب | Add WhatsApp Device

1. اذهب إلى **الأجهزة المتصلة**
2. اضغط على **إضافة جهاز جديد**
3. أدخل اسم الجهاز ورقم الهاتف
4. امسح QR Code بواسطة تطبيق واتساب

### 5. استخدام نظام الفلترة | Using Filter System

في صفحة **المحادثات**:
- استخدم القائمة المنسدلة **"جميع الأجهزة"** لفلترة المحادثات
- كل محادثة تعرض رقم الجهاز الخاص بها
- يمكنك البحث والفلترة في نفس الوقت

---

## تشغيل النظام | Running the System

### 1. تشغيل الـ Migrations

```bash
php artisan migrate
```

### 2. إنشاء المستخدم الأساسي

```bash
php artisan db:seed --class=AdminUserSeeder
```

### 3. تشغيل الخادم

```bash
php artisan serve
```

### 4. تشغيل خدمة واتساب

```bash
cd whatsapp-service
npm install
node server.js
```

---

## الصلاحيات | Permissions

### صلاحيات المدير | Admin Permissions
- الوصول الكامل لجميع الميزات
- إدارة المستخدمين
- مراقبة النشاط
- إدارة الأجهزة
- الرد على المحادثات

### صلاحيات الموظف | Agent Permissions
- الرد على المحادثات (reply_to_chats)
- عرض جميع المحادثات (view_all_chats)
- تعيين المحادثات (assign_chats)
- إرسال رسائل جديدة (send_messages)

---

## Routes الرئيسية | Main Routes

### Admin Routes (للمدير فقط)
```
/admin/dashboard - لوحة التحكم
/admin/users - إدارة المستخدمين
/admin/activity - نشاط المستخدمين
/admin/devices - الأجهزة المتصلة
```

### Agent & Admin Routes
```
/whatsapp/chats - صفحة المحادثات
```

---

## الأمان | Security

- **التحقق من الدور**: كل route محمي بـ middleware
- **تشفير كلمات المرور**: باستخدام bcrypt
- **CSRF Protection**: على جميع النماذج
- **Session Management**: إدارة الجلسات الآمنة

---

## الدعم الفني | Technical Support

للمساعدة أو الاستفسارات، يرجى التواصل مع فريق التطوير.

---

## ملاحظات مهمة | Important Notes

1. **تأكد من تشغيل خدمة واتساب** قبل استخدام النظام
2. **قم بعمل نسخة احتياطية** من قاعدة البيانات بشكل دوري
3. **غيّر كلمات المرور الافتراضية** فوراً بعد التثبيت
4. **راقب نشاط المستخدمين** بانتظام للتأكد من الأداء الأمثل

---

## التحديثات المستقبلية | Future Updates

- تقارير تفصيلية عن أداء الموظفين
- إشعارات فورية للمحادثات الجديدة
- نظام تقييم خدمة العملاء
- تكامل مع أنظمة CRM

---

تم بناء هذا النظام بعناية لتوفير تجربة إدارة شاملة وسهلة الاستخدام لفريق خدمة العملاء.
